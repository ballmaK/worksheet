# 团队管理功能设计文档

## 1. 功能概述
团队管理页面提供完整的团队管理功能，包括团队信息管理、成员管理、项目关联、团队动态等功能。

## 2. 页面布局设计

### 2.1 团队概览页面
```
┌─────────────────────────────────────────────────────────────┐
│ 团队管理 - [团队名称]                                        │
├─────────────────────────────────────────────────────────────┤
│ 团队信息卡片                                                 │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 团队名称: 技术开发团队                                     │ │
│ │ 团队描述: 负责公司核心产品的技术开发和维护                │ │
│ │ 创建时间: 2024-01-15 | 成员数量: 8人                      │ │
│ │ 项目数量: 5个 | 活跃状态: 活跃                            │ │
│ │ [编辑团队] [邀请成员] [团队设置]                          │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 功能导航标签                                                 │
│ [成员管理] [项目列表] [团队动态] [团队设置] [权限管理]        │
├─────────────────────────────────────────────────────────────┤
│ 内容展示区域                                                 │
│ (根据选择的标签显示不同内容)                                  │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 成员管理标签页
```
┌─────────────────────────────────────────────────────────────┐
│ 成员管理                                                     │
├─────────────────────────────────────────────────────────────┤
│ 操作区域                                                     │
│ [邀请新成员] [批量操作] [导出成员列表]                        │
├─────────────────────────────────────────────────────────────┤
│ 成员列表                                                     │
│ ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐ │
│ │ 头像    │ 姓名    │ 角色    │ 加入时间│ 状态    │ 操作    │ │
│ ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤ │
│ │ [头像]  │ 张三    │ 管理员  │ 2024-01-│ 活跃    │ [编辑]  │ │
│ │         │         │         │ 15      │         │ [移除]  │ │
│ ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤ │
│ │ [头像]  │ 李四    │ 成员    │ 2024-01-│ 活跃    │ [编辑]  │ │
│ │         │         │         │ 20      │         │ [移除]  │ │
│ └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 项目列表标签页
```
┌─────────────────────────────────────────────────────────────┐
│ 团队项目列表                                                 │
├─────────────────────────────────────────────────────────────┤
│ 筛选条件                                                     │
│ [全部项目] [进行中] [已完成] [已暂停] [搜索项目]              │
├─────────────────────────────────────────────────────────────┤
│ 项目卡片列表                                                 │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目A - 电商平台开发                                      │ │
│ │ 进度: 75% | 状态: 进行中 | 负责人: 张三                    │ │
│ │ 开始时间: 2024-01-01 | 预计完成: 2024-06-30               │ │
│ │ 成员: 张三, 李四, 王五                                    │ │
│ │ [查看详情] [编辑项目] [项目动态]                          │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目B - 移动端APP开发                                     │ │
│ │ 进度: 45% | 状态: 进行中 | 负责人: 李四                    │ │
│ │ 开始时间: 2024-02-01 | 预计完成: 2024-08-30               │ │
│ │ 成员: 李四, 王五, 赵六                                    │ │
│ │ [查看详情] [编辑项目] [项目动态]                          │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 2.4 团队动态标签页
```
┌─────────────────────────────────────────────────────────────┐
│ 团队动态                                                     │
├─────────────────────────────────────────────────────────────┤
│ 动态时间线                                                   │
│                                                             │
│ 2024-12-19 14:30                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [头像] 张三 完成了任务 "用户管理模块开发"                  │ │
│ │ 项目: 电商平台开发 | 工时: 8.5小时                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 2024-12-19 12:15                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [头像] 李四 加入了项目 "移动端APP开发"                     │ │
│ │ 角色: 开发工程师                                          │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 2024-12-19 10:00                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [头像] 王五 创建了新任务 "数据库优化"                      │ │
│ │ 项目: 电商平台开发 | 优先级: 高                           │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 3. 编辑团队功能设计

### 3.1 编辑团队对话框
```
┌─────────────────────────────────────────────────────────────┐
│ 编辑团队信息                                                 │
├─────────────────────────────────────────────────────────────┤
│ 团队名称: [技术开发团队                    ]                 │
│ 团队描述: [负责公司核心产品的技术开发和维护                ] │
│ 团队头像: [上传图片] [当前头像预览]                          │
│ 团队标签: [技术] [开发] [核心] [x] [添加标签]                │
│ 可见性: ○ 公开团队  ● 私有团队                              │
│ 邀请设置: ● 允许成员邀请  ○ 仅管理员邀请                    │
├─────────────────────────────────────────────────────────────┤
│ [保存] [取消]                                               │
└─────────────────────────────────────────────────────────────┘
```

## 4. 功能特性

### 4.1 成员管理
- **邀请成员**: 通过邮箱邀请新成员
- **角色管理**: 设置成员角色（管理员、成员）
- **权限控制**: 不同角色拥有不同权限
- **成员状态**: 活跃、离线、离开状态管理
- **批量操作**: 批量邀请、批量移除

### 4.2 项目关联
- **项目列表**: 显示团队关联的所有项目
- **项目状态**: 实时显示项目进度和状态
- **成员分配**: 查看项目成员分配情况
- **项目动态**: 项目相关的最新动态

### 4.3 团队动态
- **实时更新**: 团队成员活动实时显示
- **动态类型**: 任务完成、成员加入、项目创建等
- **时间线展示**: 按时间顺序展示动态
- **筛选功能**: 按类型、时间筛选动态

### 4.4 团队设置
- **基本信息**: 团队名称、描述、头像
- **权限设置**: 成员权限、邀请权限
- **可见性设置**: 公开团队、私有团队
- **标签管理**: 团队标签分类

## 5. API接口设计

### 5.1 获取团队信息
```http
GET /api/v1/teams/{team_id}
```

### 5.2 更新团队信息
```http
PUT /api/v1/teams/{team_id}
Body:
{
  "name": "团队名称",
  "description": "团队描述",
  "avatar": "头像URL",
  "tags": ["标签1", "标签2"],
  "visibility": "public|private",
  "invite_permission": "admin_only|member_allowed"
}
```

### 5.3 获取团队项目列表
```http
GET /api/v1/teams/{team_id}/projects
Query Parameters:
- status: 项目状态
- keyword: 搜索关键词
- page: 页码
- size: 每页数量
```

### 5.4 获取团队动态
```http
GET /api/v1/teams/{team_id}/activities
Query Parameters:
- type: 动态类型
- start_date: 开始日期
- end_date: 结束日期
- page: 页码
- size: 每页数量
```

### 5.5 获取团队成员
```http
GET /api/v1/teams/{team_id}/members
Query Parameters:
- role: 角色筛选
- status: 状态筛选
- keyword: 搜索关键词
- page: 页码
- size: 每页数量
```

### 5.6 邀请团队成员
```http
POST /api/v1/teams/{team_id}/invite
Body:
{
  "email": "user@example.com",
  "role": "member|admin",
  "message": "邀请消息"
}
```

### 5.7 更新成员角色
```http
PUT /api/v1/teams/{team_id}/members/{user_id}
Body:
{
  "role": "member|admin"
}
```

### 5.8 移除团队成员
```http
DELETE /api/v1/teams/{team_id}/members/{user_id}
```

## 6. 数据模型设计

### 6.1 团队活动模型
```python
class TeamActivity(Base):
    __tablename__ = "team_activities"
    
    id = Column(Integer, primary_key=True, index=True)
    team_id = Column(Integer, ForeignKey("teams.id"))
    user_id = Column(Integer, ForeignKey("users.id"))
    activity_type = Column(String(50))  # task_completed, member_joined, project_created
    title = Column(String(200))
    content = Column(Text)
    metadata = Column(JSON)  # 存储活动相关的额外数据
    created_at = Column(DateTime, default=datetime.utcnow)
    
    team = relationship("Team", back_populates="activities")
    user = relationship("User", back_populates="team_activities")
```

### 6.2 团队项目关联模型
```python
class TeamProject(Base):
    __tablename__ = "team_projects"
    
    id = Column(Integer, primary_key=True, index=True)
    team_id = Column(Integer, ForeignKey("teams.id"))
    project_id = Column(Integer, ForeignKey("projects.id"))
    created_at = Column(DateTime, default=datetime.utcnow)
    
    team = relationship("Team", back_populates="projects")
    project = relationship("Project", back_populates="teams")
```

## 7. 技术实现要点

### 7.1 前端技术要点
- **标签页切换**: 使用Vue Router或组件切换
- **实时更新**: WebSocket推送团队动态
- **文件上传**: 团队头像上传功能
- **权限控制**: 基于角色的UI显示控制
- **搜索筛选**: 高效的搜索和筛选功能

### 7.2 后端技术要点
- **权限验证**: 团队操作权限验证
- **实时推送**: WebSocket推送团队动态
- **文件处理**: 团队头像上传和处理
- **数据关联**: 团队、项目、成员的关联查询
- **活动记录**: 自动记录团队相关活动

### 7.3 数据库优化
- **关联查询**: 优化团队相关查询性能
- **索引设计**: 为常用查询字段添加索引
- **分页查询**: 大数据量的分页优化
- **缓存策略**: 缓存团队基本信息

